202204231745
Tags:
___
# Просмотр мобильного трафика с помощью FIDDLER

Для перехвата мобильного трафика с помощью Fiddler нам понадобятся:
- Персональный компьютер
- Смартфон

1. Убедиться что ваш ПК и смартфон подключены к одной интернет сети.
2. На ПК установить приложение Fiddler, скачать его можно по ссылке
https://www.telerik.com/download/fiddler
3. Переходим в Tools > Options > Connections и выставляем галочку Allow remote computers to connect
	![[Блок 10. Тестирование мобильных приложений_Страница_08_Изображение_0001.jpg]]
4. Вписываем Port 8888 или другой (запоминаем какой порт указали)
	![[Блок 10. Тестирование мобильных приложений_Страница_08_Изображение_0002.jpg]]
5. Перезапускаем Fiddler
6. Узнаем IP вашего сетевого соединения на ПК, это можно сделать несколькими способами:
	- Можно посмотреть в самом Fiddler наведя на значок Online
		![[Блок 10. Тестирование мобильных приложений_Страница_09_Изображение_0001.jpg]]
	- В cmd выполнить команду ipconfig
7. На смартфоне необходимо прописать настройки прокси. Для этого открываем настройки Wifi соединения, к которому подключились, выбираем «Прокси вручную» и вписываем IP адрес вашего соединения и порт приложения перехвата
	В iOS это выглядит так:
	![[Блок 10. Тестирование мобильных приложений_Страница_09_Изображение_0002.jpg]]
	![[Блок 10. Тестирование мобильных приложений_Страница_10_Изображение_0001.jpg]]
	В Android это выглядит так:
	![[Блок 10. Тестирование мобильных приложений_Страница_10_Изображение_0002.jpg]]
	![[Блок 10. Тестирование мобильных приложений_Страница_10_Изображение_0003.jpg]]
	*Не забываем нажать на кнопку “Сохранить”, чтобы настройки сохранились*
8. Теперь можно попробовать перехватить HTTP трафик. Для этого на смартфоне на котором включены настройки прокси (Fiddler при этом запущен) открываем браузер (Желательно чтобы это был браузер который стоит на смартфоне по умолчанию на ios это Safari) и переходим на любой сайт, например sad.com. Видим что перехвачен HTTP трафик, запрос и ответ зашифрованы.
	![[Блок 10. Тестирование мобильных приложений_Страница_11_Изображение_0001.jpg]]
9. Для перехвата HTTPS трафика
	1. в Fiddler
	- Открываем настройки: Tools > Options > HTTPS и оставляем включенными галочки на Capture HTTPS CONNECTs, Decrypt HTTP traffic (from all procceses), Ignore server certificate errors
		![[Блок 10. Тестирование мобильных приложений_Страница_11_Изображение_0003.jpg]]
	- Внизу выбираем Perform decryption only for following hosts (делать это нужно потому что при расшифровке всех сразу происходят иногда конфликты и для быстрой работы лучше конкретно те что вам необходимы) и вписываем в поле нужные вам хосты через точку с запятой, например api.vk.com; google.com
	2. На смартфоне
		- Проверяем что смартфон подключен к прокси (см. п.7)
		- На смартфоне открываем браузер (лучше если это будет браузер который установлен по умолчанию на устройстве) и переходим по ссылке ipv4.fiddler:8888/ (слэш в конце обязателен, если не поставить браузер будет гуглить вписанное или пишите ссылку целиком `http://ipv4.fiddler:8888`). Порт в этой ссылке указывается тот что вы указали в настройках Fiddler.
		![[Блок 10. Тестирование мобильных приложений_Страница_12_Изображение_0002.jpg]]
		Нажимаем Fiddler Root Certificate
	3. *Далее выполняем действия в зависимости от платформ*
		1.  В iOS:
			- После скачивания сертификат необходимо установить, для этого переходим в в Настройки > Основные > Профили , открываем профиль Нажимаем Разрешить > Установить > Вводим пин-код (если есть) > Установить > Готово
			- Далее включаем доверие сертификата, переходим в Настройки > Основные > Об этом устройстве > Доверие сертификатов > Переключить в состояние ВКЛ на DO_NOT_TRUST_FiddlerRoot
		2.  В Android
			Скачается сертификат и в зависимости от версий андроида и их кастомности либо пойдет установка сертификата, либо надо будет установить его вручную
			- Переходим в Настройки, ищем и открываем раздел Конфиденциальность или Безопасность (они могут быть в разных местах)
			- Находим и нажимаем на пункт Установить с карты памяти (данный пункт обычно расположен под блоком Надежные сертификаты или Доверенные сертификаты)
			- Выбираем скачанный сертификат (обычно он располагается в папке Download)
			- Вписываем название любое (я назвал Fiddler) и указываем Использовать аккаунт: VPN и приложения и нажимаем ОК
10. Перезапускаем Fiddler
11. Через смартфон совершаем запрос (открываем приложение) — теперь вы можете видеть ответы c HTTPS среди других ответов.
	![[Блок 10. Тестирование мобильных приложений_Страница_13_Изображение_0001.jpg]]

## Возможные проблемы

**Почему не перехватывается трафик?**
HTTP трафик может не перехватываться по следующим причинам:
1. Смартфон и ПК находятся не в одной сети
2. Неверно настроен прокси (указан неверный ip адрес или порт)
3. После настроек Fiddler не был перезагружен
4. Смартфон (на ос android) имеет свою “защиту” (лучше попробовать перехватить трафик через браузер который установлен по умолчанию)

**HTTPS трафик может не перехватываться по следующим причинам:**
1. В настройках HTTPS не прописаны хосты
2. Сертификат не установлен
3. Не включено доверие сертификата
4. После настроек Fiddler не был перезагружен
5. Приложение игнорирует сертификаты (Попробовать перехватить трафик другого приложения)


# Подмена трафика

Подмена пакетов находится во вкладке AutoResponder
1. Чтобы активировать подмену нажимаем галочку Enable Rules, а также галочку Unmatched requests passthrough (чтобы нужные подменялись, другие запросы прорабатывались успешно).
	![[Блок 10. Тестирование мобильных приложений_Страница_14_Изображение_0003.jpg]]
2. Слева берем запрос и перетягиваем в колонку AutoResponder и активируем его галочкой
	![[Блок 10. Тестирование мобильных приложений_Страница_14_Изображение_0004.jpg]]
3. Внизу в Rule Editor во второй строке выбираем что нам надо делать при ответе и нажимаем Save.
	![[Блок 10. Тестирование мобильных приложений_Страница_15_Изображение_0002.jpg]]





# Ссылки
___
##### Links


---
##### Источники
Методичка SimbirSoft