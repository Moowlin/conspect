202105081850
Tags:
___
###
**SSH**— защищенный протокол для удаленного доступа к компьютерам. Через SSH можно выполнять операции в командной строке компьютера, который физически находится в другом месте.

Иными словами, SSH — это дистанционная командная строка. Визуально вы работаете на своем компьютере, но в реальности — на другом.

### Алгоритм установления соединения в протоколе SSH
1. **Установка TCP-соединения**
	На этом этапе происходит сетевое подключение клиента к серверу на TCP-порт, указанный в опции Port (по умолчанию: 22) в файле конфигурации сервера `/etc/ssh/sshd_config.`
2. **Открытие защищенного канала**
	- **Обмен идентификационными данными**
		- клиент и сервер обмениваются версиями SSH-протокола и другими вспомогательными данными, необходимыми для выяснения совместимости протоколов и для выбора алгоритмов работы
	- **Выбор алгоритмов: обмена ключами, шифрования, сжатия и т.п.**
		- стороны отсылают друг другу списки поддерживаемых алгоритмов, наибольший приоритет имеют алгоритмы в начале каждого списка. Затем сравнивают алгоритмы в полученных списках с алгоритмами, имеющимися в системе, и выбирают первый совпавший в каждом списке.
		
	- **Получение сессионного ключа шифрования**
		- Сервер отсылает клиенту свой *Fingerprint*
		- Если клиент производит соединение с данным сервером впервые (о чем говорит отсутствие записи в файле /home/username/.ssh/known\_hosts у клиента), то пользователю будет задан вопрос о доверии ключу сервера. Если же соединение с данным сервером уже устанавливалось ранее, то клиент сравнивает присланный ключ с ключом, записанным в /home/username/.ssh/known\_hosts. Если ключи не совпадают, то пользователь получит предупреждение о возможной попытке взлома.
		- Как только клиент определился с доверием к ключу сервера, с помощью одной из реализаций (версия определяется в п.2.2) алгоритма Диффи-Хеллмана клиент и сервер генерируют сеансовый ключ, который будет использоваться для симметричного шифрования канала.
		
- **Аутентификация клиента**
	-  Клиент отсылает серверу имя пользователя (username) и свой публичный ключ.
	-   Сервер проверяет в файле /home/username/.ssh/authorized\_keys наличие присланного клиентом открытого ключа. Если открытый ключ найден, то сервер генерирует случайное число и шифрует его открытым ключом клиента, после чего результат отправляется клиенту.
	-    Клиент расшифровывает сообщение своим приватным ключом и отправляет результат серверу.
	-    Сервер проверяет полученный результат на совпадение с тем числом, которое он изначально зашифровал открытым ключом клиента, и в случае совпадения считает аутентификацию успешной.

- **Уровень подключения**
После проведения всех вышеперечисленных процедур, пользователь получает возможность передавать команды серверу или копировать файлы.    
На этом уровне обеспечивается: мультиплицирование каналов (возможность работы множества каналов к одному серверу за счет объединения их в один канал), туннелирование и т.п.




# Ссылки
___
##### Links
[[IPTABLES]] https://losst.ru/nastrojka-iptables-dlya-chajnikov
[[Защищенные сетевые протоколы]]
[[SSH]]

---
##### Источники
[Алгоритм установления соединения в протоколе SSH](https://habr.com/ru/post/425637/)