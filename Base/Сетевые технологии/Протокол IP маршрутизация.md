202201121648
Tags:
___
# IP маршрутизация


Маршрутизация состоит из двух этапов:
1. **Изученеи сети** -  какие подсети есть в этой составной сети, какие маршрутизаторы и как эти маршрутизаторы объединены между собой.
2.  **Продвижение или forwarding** - выполняется когда сеть уже изучена и на маршрутизатор поступил пакет, для этого пакета нужно определить куда именно его отправить.


## Варианты действий маршрутизатора
В качестве примера, рассмотрим схему составной сети, здесь показаны отдельные подсети, для каждой подсети есть ее адрес и маска, а также маршрутизаторы, которые объединяют эти сети.
![[Pasted image 20220112165538.png]]

На маршрутизатор D пришел пакет
1. Если сеть, которой предназначен пакет, подключена непосредственно к маршрутизатору, то он передает пакет непосредственно в эту сеть 
2. Нужная сеть подключена к другому маршрутизатору (А), и известно, какой маршрутизатор нужен. маршрутизатор D передает пакет на следующий маршрутизатор, который может передать пакет в нужную сеть, такой маршрутизатор называется **шлюзом**.
3. Пришел пакет для сети, маршрут которой не известен, в этом случае маршрутизатор отбрасывает пакет

Что нужно знать маршрутизатору для того чтобы решить куда отправить пакет?
1. у маршрутизатора есть несколько интерфейсов, к которым подключены сети. Нужно определить в какой из этих интерфейсов отправлять пакет.
2. определить, что именно делать с этим пакетом. Есть 2 варианта:
	1. можно передать пакет в сеть (192.168.1.0/24)
	2. можно передать его на один из маршрутизаторов подключенные к этой сети - нужно знать, какой именно из маршрутизаторов подключенных к этой сети, выбрать для передачи пакета. Эту информацию маршрутизатор хранит в таблице маршрутизации.



## Таблица маршрутизации
![[Pasted image 20220112170008.png]]
Первые два столбца это адрес и маска подсети, вместе они задают адрес подсети. Затем столбцы шлюз, интерфейс и метрика. Столбец интерфейс говорит о том, через какой интерфейс маршрутизатора нам нужно отправить пакет.


Столбец шлюз, говорит что делать с пакетом, который вышел через заданный интерфейс. Для сетей, которые подключены напрямую к маршрутизатору D, в столбце шлюз, указывается «подсоединен», которое говорит о том, что сеть подключена непосредственно к маршрутизатору и передавать пакет нужно напрямую в эту сеть.


>В таблицу маршрутизации записываем только первый шаг, адрес следующего маршрутизатора, все что находится дальше нас не интересует.

## Метрика

Можно заметить, что в нашей схеме в одну и ту же сеть, например вот в эту (10.2.0.0/16) можно попасть двумя путями, первый путь проходят через один маршрутизатор F, а второй путь через два маршрутизатора B и E.

Какой путь выбрать? Для этого используются поле метрика таблицы маршрутизации.

_**Метрика**_ это некоторое число, которые характеризует расстояние от одной сети до другой. Если есть несколько маршрутов до одной и той же сети, то выбирается маршрут с меньшей метрикой.


метрика учитывает не только количество промежуточных маршрутизаторов, но и скорость каналов между сетями, потому что иногда бывает выгоднее пройти через два маршрутизатора, но по более скоростным каналам. Также может учитываться загрузка каналов, поэтому сейчас метрика — это число, которое учитывает все эти характеристики.

## Записи в таблице маршрутизации

Есть два варианта статическая маршрутизация и динамическая маршрутизация.

1. При статической маршрутизации, записи в таблице маршрутизации настраиваются вручную, это удобно делать если у вас сеть небольшая и изменяется редко, но если сеть крупная, то выгоднее использовать динамическую маршрутизацию, в которой маршруты настраиваются автоматически. В этом случае маршрутизаторы сами изучают сеть с помощью протоколов маршрутизации RIP, OSPF, BGP и других.

2. Преимущество динамической маршрутизации в том, что изменение в сети могут автоматически отмечаться в таблице маршрутизации. Например, если вышел из строя один из маршрутизаторов, то маршрутизаторы по протоколам маршрутизации об этом узнают, и уберут маршрут, который проходит через этот маршрутизатор. С другой стороны, если появился новый маршрутизатор, то это также отразится в таблице маршрутизации автоматически.

## Маршрут по умолчанию

Если маршрутизатор не знает куда отправить пакет, то такой пакет отбрасывается. Таким образом получается, что маршрутизатор должен знать маршруты ко всем подсетям в составной сети. На практике для крупных сетей, например для интернета это невозможно, поэтому используются следующие решения.

В таблице маршрутизации назначается специальный маршрутизатор по умолчанию, на которой отправляются все пакеты для неизвестных сетей, как правило это маршрутизатор, который подключен к интернет.

Предполагается что этот маршрутизатор лучше знает структуру сети, и способен найти маршрут в составной сети. Для обозначения маршрута по умолчанию, в таблице маршрутизации используются четыре нуля в адресе подсети и четыре нуля в маске (0.0.0.0, маска 0.0.0.0), а иногда также пишут default.





# Ссылки
___
##### Links


---
##### Источники
https://zvondozvon.ru/tehnologii/kompyuternye-seti/marshrutizatsiya
