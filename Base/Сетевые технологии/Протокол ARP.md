202201241010
Tags:
___
# Протокол ARP

**ARP** (англ. _Address Resolution Protocol_ — протокол разрешения адреса) — протокол канального уровня.
Протокол ARP (address resolution protocol, RFC-826, std-38) решает проблему преобразования IP-адреса в МАС-адрес.

данные передаются с помощью какой-нибудь технологии [[Канальный уровень|канального уровня]], например [[Технология Ethernet|Ethernet]]. [[Коммутаторы Ethernet|Коммутаторы Ethernet]] ничего не знают об IP-адресах и для передачи данных используют MAC-адреса. Следовательно, необходимо средство, которое позволяет по IP-адресу компьютера определить его [[MAC адреса|МАC-адрес]].

Существует четыре типа ARP-сообщений:
-   ARP-запрос (ARP request);
-   ARP-ответ (ARP reply);
-   RARP-запрос (RARP-request);
-   RARP-ответ (RARP-reply).

> **RARP** (англ. Reverse Address Resolution Protocol - Обратный протокол преобразования адресов) - протокол третьего (сетевого) уровня модели OSI, выполняет обратное отображение адресов, то есть преобразует аппаратный адрес в IP-адрес.


## ARP-запрос
Протокол ARP позволяет автоматически определить МАК-адрес компьютера по его IP-адресу. Протокол работает в режиме запрос-ответ.
Компьютер, который хочет узнать МАК-адрес по известному IP-адресу, направляет ARP запрос “У кого IP 192.168.10.43?” Запрос отправляется на широковещательный МАК-адрес (FF:FF:FF:FF:FF:FF).
Тот компьютер, который узнал в запросе свой IP-адрес подготавливает и отправляет ARP ответ. В ответ включается IP-адрес компьютера (IP:192.168.10.43) и его МАК-адрес (MAC: 54:BE:F7:88:15:47).
Отправитель ARP запроса получает ответ, извлекает из него МАК-адрес и использует его для передачи данных по технологии канального уровня.


### Формат ARP-запроса

ARP разрабатывался, как протокол общего назначения с возможностью применять его не только в Ethernet и не только для IP-адресов. Поэтому в начале ARP пакета идет служебная информация, которая позволяет определить с каким типом сетевого оборудования и с каким протоколом сетевого уровня мы работаем.

![[Pasted image 20220124104135.png]]

-   *Hardware type (HTYPE)* Каждый канальный протокол передачи данных имеет свой номер, который хранится в этом поле. Например, Ethernet имеет номер 0x0001
-   *Protocol type (PTYPE)* Код сетевого протокола. Например, для IPv4 будет записано 0x0800
-   *Hardware length (HLEN)* Длина физического адреса в байтах. Адреса Ethernet имеют длину 6 байт.
-   *Protocol length (PLEN)* Длина логического адреса в байтах. IPv4 адреса имеют длину 4 байта.
-   *Operation* Код операции отправителя: 1 в случае запроса и 2 в случае ответа.
-   *Sender hardware address (SHA)* Физический адрес отправителя.
-   *Sender protocol address (SPA)* Логический адрес отправителя.
-   *Targethardwareaddress (THA)* Физический адрес получателя. Поле пусто при запросе.
-   *Target protocol address (TPA)* Логический адрес получателя.


## Таблица соответствия ARP
Самое простое средство это таблица соответствия. Мы создаем таблицу, в которой пишем IP-адрес и соответствующий ему MAC-адрес.

![[Pasted image 20220124101510.png]]
Такое средство действительно используется на практике, например в Linux такая табличка хранится в файле `/etc/ethers`. Однако в крупной сети такой подход не работает.

После того, как МАК-адрес получателя найден, он кэшируется на компьютеры отправителя в ARP-таблице для того, чтобы не запрашивать МАК-адрес каждый раз по протоколу ARP.

Таблица состоит из 3-х полей — IP-адрес, MAC-адрес и Тип записи в ARP таблице. Есть статическая запись, которая внесена в таблицу вручную и динамическая запись, которая появилась в результате работы протокола ARP. Динамические записи имеют срок жизни после которого они удаляются, это нужно для того, чтобы отслеживать изменения IP-адресов в компьютерах.

> команда  `arp -a`
> ![[Pasted image 20220124101751.png]]





# Ссылки
___
##### Links


---
##### Источники
https://zvondozvon.ru/tehnologii/protokoli/arp