202105101130
Tags:
___
# Архитектура электронной почты
Электронная почта или *electronic mail (сокр. Email)* позволяет передавать сообщения через компьютерную сеть.
Пользователи работают с электронной почтой с помощью агентов пользователя, по английский *mail user agent*  - ПО, устанавливаемое на комп (Microsoft Outlook или Mozilla Thunderbird), а также можно работать через веб-интерфейс в браузере

![[protokol.jpg]]

Важнейшей часть почтового сервера является **MTA** (_Mail Transfer Agent_ - агент пересылки почты) в задачи которого входит прием и передача почты. MTA работает по протоколу SMTP. **MTA - это почтовое отделение**

**MDA** (_Mail Delivery Agent_ - агент доставки почты), его задача по запросу почтового клиента передать ему почту из почтового ящика на сервере. MDA может работать по протоколам POP3 или IMAP  **MDA - почтальон**

**хранилище сообщени**й - это почтовые ящики на сервере, где письма хранятся и ждут, когда пользователь за ними обратится.

## Алгоритм работы
![[IT-tech-mail1.png]]

1. Пользователь готовит сообщение с помощью *mail user agent*, который соединяется с МТА по протоколу SMTP и первым делом сообщает свои учетные данные. 
2. Авторизовав пользователя, MTA принимает сообщение и пытается доставить его дальше. (без авторизации мы получим открытый релей, т.е. любой может воспользоваться нашим сервером для пересылки почты, а как спамеры обрадуются)
3. MTA анализирует служебную информацию письма, определяя домен получателя, если он относится к доменам обслуживаем данным МТА, производится поиск получателя и письмо помещается в его ящик.
4. Если домен получателя не обслуживается MTA, формируется DNS-запрос, запрашивающий MX-записи ([[Типы записей DNS]]) для данного домена.
5. При отсутствии MX-записи запрашивается A-запись (запись адреса, сопоставляющая доменное имя с IP-адресом) и выполняется попытка доставить почту на указанный там хост. При невозможности отправить сообщение, оно возвращается отправителю (помещается в почтовый ящик пользователя) с сообщением об ошибке.
6.  устанавливает соединение по 25 (587 или 465) порту и передает email сообщение серверу на стороне получателя.
7. Получив входящее сообщение, MTA проверяет домен получателя, если он входит в число обслуживаемых MТА, обработка сообщения продолжается, иначе сервер отказывается принимать почту. После проверки домена проверяется получатель, если он присутствует в списке пользователей, сообщение доставляется в его ящик, в противном случае возможны два варианта: отказ от приема сообщения или прием сообщения в общий почтовый ящик (ящик администратора). С одной стороны такая настройка увеличивает число принимаемого спама, с другой позволяет не потерять письма с ошибками в написании адреса. Еще одной мерой защиты от спама является запрос PTR-записи. PTR-запись (запись указателя) связывает IP-адрес с именем домена. Запрашивая PTR, MTA принимает почту только в том случае если домен отправителя совпадает с доменом отправляющего сервера.
8. Для получения почты клиент устанавливает соединение с MDA по протоколу POP3 или IMAP, обязательно передавая данные для авторизации. MDA проверяет наличие пользователя в списках и, при успешной проверке, передает клиенту все новые сообщения находящиеся в его почтовом ящике.




# Ссылки
___
##### Links
[[Протокол SMTP]]
[[Протокол POP3]]
[[Протокол IMAP]]


---
##### Источники
[Почтовый сервер для начинающих. Структура и принцип работы](https://interface31.ru/tech_it/2010/09/pochtovyj-server-struktura-i-princip-raboty.html)
[Обзорная лекция по электронной почте](https://www.youtube.com/watch?v=ocshYn2D_8g)