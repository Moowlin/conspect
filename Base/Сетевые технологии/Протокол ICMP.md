202201241112
Tags:
___
# Протокол ICMP

*Протокол ICMP (Internet Control Message Protocol)* — протокол межсетевых управляющих сообщений.

[[Протокол IP|Протокол IP]], который используется для передачи данных на сетевом уровне, обеспечивает сервис передачи данных без гарантии доставки.

Информация о возникающих ошибках в сети передается по протоколу ICMP. А также протокол ICMP может использоваться для диагностики работы в сети даже, когда в ней не возникают ошибки.

Принцип работы ICMP заключается в том, что данный протокол срабатывает для передачи сообщений об ошибках при передаче или исключительных ситуациях, то есть когда маршрутизатор не работает или требуемая услуга недоступна. По сути протокол ICMP не может запросить послать потерянный пакет повторно, а просто оповещает о несчастных случаях.

Когда протокол IP определяет, что дальнейшая передача пакета невозможно, перед тем как уничтожить пакет, должен отослать узлу-источнику диагностическое ICMP-сообщение. Если при передаче самого ICMP-сообщения возникла ситуация препятствующая его передачу, то протокол ICMP не будет отправлять об этом диагностическое сообщения, для избегания «штормов» в сетях.

При передаче по сети, сообщения ICMP инкапсулируются в поле данных IP-пакетов.

## Формат заголовка ICMP

![[Pasted image 20220124133400.png]]

Заголовок ICMP-сообщения состоит из 8 байт:

-   тип (1 байт) – числовой идентификатор типа сообщения: 0 или 8, где 0 - **ICMP reply** (ответ), 8 - **ICMP request** (запрос);
-   код (1 байт) – числовой идентификатор, более точно определяющий тип ошибки
-   контрольная сумма (2 байта) – вычисляется для всего ICMP-сообщения
-   Оставшиеся 4 байта и поле данных зависит от значений полей типа и кода.

## Типы ICMP — сообщений

Самое важно в пакете ICMP это тип сообщений. Именно тип, говорит о том, что произошло в сети. Есть 2 вида ICMP сообщений. Первый вид это запрос-ответ.

![[Pasted image 20220124133524.png]]


## Коды ICMP — сообщений
Следующее поле в заголовке ICMP это код сообщения
![[Pasted image 20220124133609.png]]

## Применение ICMP

Большая часть пакетов ICMP формируется и отправляется автоматически сетевым оборудованиям. Но некоторые типы сообщений формируются утилитами, которые применяются для диагностики сети. Например, [[Команда ping|утилиты ping]] и [[Команда traceroute|traceroute]] (в Windows tracert)

# Ссылки
___
##### Links


---
##### Источники
