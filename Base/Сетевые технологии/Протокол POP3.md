202104292137
Tags:
___

**POP3** (протокол почтового отделения версия 3) часто используется для связи с удаленным сервером электронной почты и загрузки сообщений на локальный почтовый клиент с последующим удалением его на сервере, к примеру Outlook, Windows Mail, Mac Mail
Однако обычно почтовые клиенты предлагают выбор — оставлять или нет копии сообщений на сервере.

Порты POP3, по умолчанию являются такими:
- Порт 110 — порт без шифрования
- Порт 995 — порт SSL/TLS, также известный как **POP3S**

**Преимущеста:**
- письма будут доступны и при отсутствии интернета

**Недостатки:**
-  возможность работы только одного почтового клиента, который удаляет все письма, после того, как загрузил себе
-  а если настроить сохранение писем на сервере, то не не можем определить на сервер пришло новое письмо или мы его уже читали
-  РОР3 считает почтовый ящик единым хранилищем писем. Нет возможности создавать папки, настраивать фильтры, чтобы сообщения автоматический попадали в эти папки, как то помечать письма и выполнять другие подобные действия.

## Алгоритм работы
При работе по протоколу РОР3 клиент проходит через три состояния:
-   Первое состояние это *Авторизация*, клиент должен указать имя пользователя и подтвердить, что он тот, за кого себя выдает. Чаще всего для этого используется пароль.
-   Если авторизация прошла успешно, клиент переходит на стадию *Транзакции*. На этой стадии клиент загружает письма сервера и помечает письма, которые он загрузил на удаление. Однако реально сообщения не удаляются.
-   Удаления сообщений происходит на стадии *обновления*. Клиент говорит серверу, что он выполнил все полезные действия и готов отключится, только после этого сервер удаляет помеченные сообщения и закрывает соединение. Это сделано для того чтобы не потерять письма в результате сбоя в работе почтового клиента. Клиент переходит на стадию обновления, только после того как убедиться, что все сообщения загружены и их можно безопасно удалять с сервера. Если в процессе загрузки произошла ошибка в работе клиента, то сервер  не будет удалять помеченное сообщение и их можно будет загрузить в следующий раз.

## Команды POP3
![[3.jpg]]

 Команды USER и PASS используются на стадии авторизации
 команды STAT, LIST, RERT, TOP, DELE выполняются на стадии транзакции
 
## Ответы POP3
В РОР3 всего лишь 2 варианта ответа на команды:

-   ответ +ОК свидетельствует об успешном завершении команды.
-   ответ -ERR говорит о том произошла ошибка. 

>### Пример сеанса POP3
>![[4.jpg]]
>1. подключаемся к серверу РОР3 и устанавливаем TCP соединение с портом 110
>2. +OK Cyrus POP3 server ready  // сервер отвечает сообщением со статусом +ОК сервер РОР3 готов.
>3. USER asozykin // сначала нужно пройти авторизацию, для этого используется команду USER, где указывается имя пользователя.
>4. +OK Name is a valid mailbox // в ответ сервер передает сообщение со статусом +ОК и говорит, что у данного пользователя есть почтовый ящик на этом сервере.
>5. PASS 1234qwer//затем мы передаем пароль с помощью команды PAS.
>6. +OK Mailbox locked and ready // сервер отвечает сообщением со статусом +ОК команда выполнена успешно, почтовый ящик заблокирован и готов для работы.
>
>Мы помним, что протокол РОР3 рассчитан на работу только с одним клиентом, поэтому после того, как мы прошли стадию авторизации, почтовый ящик блокируется, и никакой другой клиент не может подключиться, пока мы не выйдем из соединения с помощью QUIT.
>
>7. STAT //после успешной авторизации, начинается стадия транзакции. Сначала мы хотим узнать, сколько всего сообщений в ящике, для этого используется команда STAT. 
>8. +ОК 311 141957394 // Сервер отвечает сообщением  +ОК команда выполнена успешно, писем в ящике 311, общий размер почтового ящика в байтах.
>9. LIST // затем мы получаем список всех сообщений с помощью команды LIST, команда LIST вывод перечень сообщений
>10. +OK scan listing follows
>11. 1 61960 // указывается номер сообщения и его размер.  
>2 2938 // здесь указана информация только о 2 письмах, на самом деле в выводе информация о 311 письмах.  
>…  
>. // и завершается вывод командой LIST точкой.
>12. RETR 1 //После того, как мы узнали сколько у нас есть сообщений и какой их размер, мы можем загрузить их на клиент. Для этого используется команда RETR указываем номер сообщения, который хотим загрузить.
>13. +OK message follow // Сервер отвечает сообщением  +ОК  
…  // и передает письмо
>14. DELE 1 // после того, как сообщение загружено, мы можем пометить его на удаление с помощью команды DELE
>15. +OK marked deleted // в ответ сервер выдает сообщение +ОК команда выполнена успешно, сообщение помечено на удаление. Таким образом мы можем загрузить оставшиеся 310 сообщений.
>16. QUIT // после того, как мы загрузим все письма которые нам нужны, мы выдаем команду QUIT  на этом стадия транзакции заканчивается и начинается стадия обновления.
>17. +OK Connection closed // сообщения которое помечены на удаление, удаляются и сервер разрывает соединение.




# Ссылки
___
##### Links
[[Электронная почта]]

---
##### Источники
[Видеолекция по протоколу чтения электронной почты POP3](https://www.youtube.com/watch?v=1swSSGvmnwU)
[Подробное описание протокола почтового отделения POP3](https://zvondozvon.ru/tehnologii/protokoli/pop3)