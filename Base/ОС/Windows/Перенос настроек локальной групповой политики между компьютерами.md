202210312056
Tags:
___
# Проблемы переноса локальных Group Policy между компьютерами


Самый простой способов перенести настройки локальной GP (групповой политики) между компьютерами – вручную скопировать содержимое папки `%systemroot%\System32\GroupPolicy `(по умолчанию этот каталог скрыт) с одного компьютера на другой с заменой содержимого (после замены файлов нужно вручную запустить обновление политик командой gpupdate /force или перезагрузить ПК).

Этот метод довольно прост, но имеет несколько существенных недостатков:

1. Так не переносятся локальные параметры безопасности (Security Templates);
2. Есть вероятность неработоспособности GPO, если версия или сборка ОС на компьютере-доноре и получателе сильно отличаются;
3. Невозможность создания на базе локальной политики доменной GPO (импорта политики в домен Active Directory для дальнейшего использования);
4. При копировании политики придется вручную править любые упоминания имени локального компьютера в настройках;
5. Есть ряд проблем с переносом нестандартных admx шаблонов.

## Утилита LGPO.exe для управления локальными GPO

Утилита консольной строки **LGPO.exe** предназначена для автоматизации управления локальными групповыми политиками и предназначена заменить более не поддерживаемую утилиту LocalGPO. Поэтому в настоящий момент рекомендуется использовать только ее. LGPO.exe входит в состав Security Compliance Manager (SCM).

Скачать LGPO.exe можно по ссылке [https://www.microsoft.com/en-us/download/details.aspx?id=55319](https://www.microsoft.com/en-us/download/details.aspx?id=55319)**.**

![[Pasted image 20221031205926.png]]

Утилита LGPO.exe обладает следующими возможностями:

-   Возможность экспорта настроек локальной групповой политик.
-   Импортировать настройки GPO из резервной копии. Поддерживается импорт в том числе файлов registry.pol, шаблонов безопасности, CSV файлов.
-   Преобразование файлов registry.pol в удобочитаемый формат LGPO и наоборот.

Чтобы экспортировать текущие настройки локальной GPO в указанный каталог, выполните команду:

`LGPO.exe /b c:\tools\GPO`

![[Pasted image 20221031205950.png]]

Утилита выгрузит все текущие настройки политик в папку с GUID групповой политики.

Чтобы представить текущие настройки GPO в файле резервной копии из файла registry.pol в удобном для анализа текстовом виде, выполните команду:

`lgpo.exe /parse /m "C:\tools\GPO\{6DFFBBF4-91A3-4235-925B-FD108878E8F}\DomainSysvol\GPO\Machine\registry.pol">>c:\tools\gpo\lgpo.txt`

Откройте текстовый файл lgpo.txt. Как вы видите, в нем содержаться все настройки реестра, которые применяются данной политикой.

![[Pasted image 20221031210004.png]]

Внесите необходимые изменения в файл с параметрами реестра lgpo.txt и сконвертируйте его в формат registry.pol:

`LGPO.exe /r "C:\tools\GPO\lgpo.txt" /w "C:\tools\GPO\registry_new.pol"`

Теперь импортируйте новые настройки политик из pol файла:

`LGPO.exe /m "C:\tools\GPO\registry_new.pol"`

![[Pasted image 20221031210018.png]]

Чтобы импортировать (перенести) настройки локальной GPO с этого компьютера на другой, скопируйте каталог с политикой на целевой компьютере и выполните команду:

`LGPO.exe /g C:\tools\GPO\`

![[Pasted image 20221031210027.png]]


Версия LGPO v2.2 поддерживает корректную работу с множественной локальной политикой (MLGPO), которая позволяет настраивать отдельные политики для разных пользователей (доступно в Windows Vista и выше).

Итак, как вы видите, пользоваться утилитой LGPO.exe для создания бэкапа локальных политик и переноса настроек GPO между компьютерами совсем несложно.


# Ссылки
___
##### Links


---
##### Источники
