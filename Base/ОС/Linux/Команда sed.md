202106281433
Tags:
___
# Описание команды
Команда sed - это потоковый редактор текста, работающий по принципу замены. Его можно использовать для поиска, вставки, замены и удаления фрагментов в файле. С помощью этой утилиты вы можете редактировать файлы не открывая их.

## Unix Sed Working methodology

This is called as one execution cycle. Cycle continues till end of file/input is reached.

1.  Read a entire line from [[Потоки даных|stdin]]/file.
2.  Removes any trailing newline.
3.  Places the line, in its pattern buffer.
4.  Modify the pattern buffer according to the supplied commands.
5.  Print the pattern buffer to stdout.


>Синтаксис: 
`$ sed options command file`
>Синтаксис команды при использовании флага:
>`s/pattern/replacement/flags`

### Основные опции:
-   **-n, --quiet** - не выводить содержимое буфера шаблона в конце каждой итерации;
-   **-e** - команды, которые надо выполнить для редактирования;
-   **-f** - прочитать команды редактирования из файла;
-   **-i** - сделать резервную копию файла перед редактированием;
-   **-l** - указать свою длину строки;
-   **-r** - включить поддержку расширенного синтаксиса регулярных выражений;
-   **-s** - если передано несколько файлов, рассматривать их как отдельные потоки, а не как один длинный.

### Адреса `sed`
Каждой команде можно передать адрес, который будет указывать на строки, для которых она будет выполнена:

-   **номер** - позволяет указать номер строки, в которой надо выполнять команду;
-   **первая~шаг -** команда будет выполняется для указанной в первой части сроки, а затем для всех с указанным шагом;
-   **$** - последняя строка в файле;
-   **/регулярное_выражение/** - любая строка, которая подходит по регулярному выражению. Модификатор l указывает, что регулярное выражение должно быть не чувствительным к регистру;
-   **номер, номер** - начиная от строки из первой части и заканчивая строкой из второй части;
-   **номер, /регулярное_выражение/** - начиная от сроки из первой части и до сроки, которая будет соответствовать регулярному выражению;
-   **номер, +количество** - начиная от номера строки указанного в первой части и еще плюс **количество** строк после него;
-   **номер, ~число** - начиная от строки номер и до строки номер которой будет кратный **числу**.

Если для команды не был задан адрес, то она будет выполнена для всех строк. Если передан один адрес, команда будет выполнена только для строки по этому адресу. Также можно передать диапазон адресов. Тогда адреса разделяются запятой и команда будет выполнена для всех адресов диапазона.

### Команды `sed`:
Если вы хотите пользоваться sed, вам нужно знать команды редактирования. Рассмотрим самые часто применяемые из них:

-   **#** - комментарий, не выполняется;
-   **q** - завершает работу сценария;
-   **d** - удаляет буфер шаблона и запускает следующую итерацию цикла;
-   **p** - вывести содержимое буфера шаблона;
-   **n** - вывести содержимое буфера шаблона и прочитать в него следующую строку;
-   **s/что_заменять/на_что_заменять/опции** - замена символов, поддерживаются регулярные выражения;
-   **y/символы/символы** - позволяет заменить символы из первой части на соответствующие символы из второй части;
-   **w** - записать содержимое буфера шаблона в файл;
-   **N** - добавить перевод строки к буферу шаблона;
-   **D** - если буфер шаблона не содержит новую строку, удалить его содержимое и начать новую итерацию цикла, иначе удалить содержимое буфера до символа перевода строки и начать новую итерацию цикла с тем, что останется;
-   **g** - нужно обработать все вхождения шаблона, имеющиеся в строке;
-   **G** - добавить новую строку к содержимому буфера шаблона, затем добавить туда же содержимое дополнительного буфера.
-   При передаче номера учитывается порядковый номер вхождения шаблона в строку, заменено будет именно это вхождение.
-   **a** - вставить текст после строки.
-   **i**  - вставить текст перед строкой.
-   **c** - Заменить строки текстом
-   **y** - замена символов. Используя эту команду, нужно учесть, что она применяется ко всему текстовому потоку, ограничить её конкретными вхождениями символов нельзя.
-   **=** - вывести номера строк

```shell
sysadmin@localhost:~$ echo "Another test" | sed 'i\First test'                  
First test                                                                      
Another test
sysadmin@localhost:~$ echo "Another test" | sed 'a\First test'                  
Another test                                                                    
First test
sysadmin@localhost:~$ echo "Another test" | sed 'c\First test'                  
First test
```




>Утилите можно передать несколько команд, для этого их надо разделить ==точкой с запятой или использовать две опции -e==. Теперь вы знаете всё необходимое и можно переходить к примерам
>**Пример:**
>```shell
>$ sed -e 's/This/That/; s/test/another test/' ./myfile
>```
>```shell
>sysadmin@localhost:~/Documents$ sed -n '1p; 10p' alpha.txt                       
A is for Apple                                                                  
J is for Juice                                                                  
sysadmin@localhost:~/Documents$ sed -n -e'1p' -e'10p' alpha.txt                 
A is for Apple                                                                  
J is for Juice

### Символы-разделители
sed позволяет самостоятельно задавать символы-разделители для использования их в команде замены. Разделителем считается первый символ, который будет встречен после `s`:  
  
``` shell
$ sed 's!/bin/bash!/bin/csh!' /etc/passwd
```

# Примеры использования sed
Пример с потоком:
```shell
sysadmin@localhost:~$ echo "This is a test"                                     
This is a test                                                                  
sysadmin@localhost:~$ echo "This is a test" | sed 's/test/another test/'        
This is a another test
```

`sed -n '5,10p' /etc/group` - вывести с 5 по 10 строки файла /etc/group
`sed '1,20d' /etc/group` - вывести весь файл, кроме строк с первой по двадцатую
`sed 's/root/losst/g' /etc/group` - Замена вхождения слова root на losst в том же файле и всё в стандартный вывод
`sed '1,10 s/0/1000/g' /etc/group` - замена всех 0 на 1000 в строках с первой по десятую
`sed '/^#\|^$\| *#/d' /etc/apache2/apache2.conf` - Переходим ещё ближе к [[Регулярные выражнеия linux|регулярным выражением]], удалим все пустые строки или строи с комментариями из конфига Apache
 ## Чтение команд из файла
Если имеется множество команд sed, с помощью которых надо обработать текст, обычно удобнее всего предварительно записать их в файл. Для того, чтобы указать sed файл, содержащий команды, используют ключ `-f`:  
Вот содержимое файла `mycommands`:  
```
s/This/That/
s/test/another test/
```
Взовем sed, передав редактору файл с командами и файл для обработки:  
``` shell
$ sed -f mycommands myfile
```


___
##### Links


---
##### Источники

[manual](http://www.gnu.org/software/sed/manual/sed.html)
[Bash-скрипты, часть 7: sed и обработка текстов](https://habr.com/ru/company/ruvds/blog/327530/)
<iframe height=500 width=700 src="https://habr.com/ru/company/ruvds/blog/327530/""></iframe>
																				  

																				  
<iframe height=500 width=700 src="http://www.gnu.org/software/sed/manual/sed.html"></iframe>
																				  
