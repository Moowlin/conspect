202104282344
Tags:
___
###
SSH (от англ. “Secure Shell”) — это протокол удаленного администрирования, разработанный для осуществления удаленного управления операционными системами и туннелирования TCP-соединения. Использование этого протокола допускает использование разных алгоритмов шифрования, что позволяет безопасно работать практически в любой незащищенной среде: работать с ПК через командную оболочку, передавать по шифрованному каналу любой тип данных (например, видео- и аудиофайлы).

Сетевой протокол Secure Shell (сокращенно SSH) используется для обмена информацией между двумя компьютерами по зашифрованному каналу с высокой степенью безопасности соединения.

### Принцип работы
SSH это протокол, использующий клиент-серверную модель для аутентификации удаленных систем и обеспечения шифрования данных, обмен которыми происходит в рамках удаленного доступа.

По умолчанию для работы протокола используется ==TCP-22 порт==: на нем сервер (хост) ожидает входящее подключение и, после получения команды и проведения аутентификации, организует запуск клиента, открывая выбранную пользователем оболочку. При необходимости пользователь может менять используемый порт.  
Для создания SSH подключения клиент должен инициировать соединение с сервером, обеспечив защищенное соединение и подтвердив свой идентификатор (проверяются соответствие идентификатора с предыдущими записями, хранящимися в RSA-файле, и личные данные пользователя, необходимые для аутентификации).

Синтаксис команды выглядит следующим образом:
`ssh [опции] имя пользователя@сервер [команда]`

самые основные опции команды ssh:
-   **f** \- перевести ssh в фоновый режим;
-   **g** \- разрешить удаленным машинам обращаться к локальным портам;
-   **l** \- имя пользователя в системе;
-   **n** \- перенаправить стандартный вывод в /dev/null;
-   **p** \- порт ssh на удаленной машине;
-   **q** \- не показывать сообщения об ошибках;
-   **v** \- режим отладки;
-   **x** \- отключить перенаправление X11;
-   **X** \- включить перенаправление Х11;
-   **C** \- включить сжатие.

## НАСТРОЙКА СЕРВЕРА SSH
Настройки сервера SSH находятся в файле `/etc/ssh/sshd_config`.
### ПОРТ SSH
По умолчанию ssh работает на порту 22. Но такое поведение небезопасно, поскольку злоумышленник знает этот порт и может попробовать выполнить Bruteforce атаку для перебора пароля. Порт задается строчкой:
`Port 22`
Поменяйте значение порта на нужное.

### ПРОТОКОЛ SSH
По умолчанию сервер ssh может работать по двум версиям протокола, для совместимости. Чтобы использовать только протокол версии два раскомментируйте строчку:
 `#Protocol 2`
 ### РУТ ДОСТУП
 По умолчанию Root доступ по ssh разрешен, но такое поведение очень небезопасно, поэтому раскомментируйте строчку:
`PermitRootLogin no`
### ДОСТУП ТОЛЬКО ОПРЕДЕЛЕННОГО ПОЛЬЗОВАТЕЛЯ К SSH
Мы можем разрешить доступ к ssh только для определенного пользователя или группы. Для этого  добавьте строчки:
`AllowUsers User1, User2, User3  
AllowGroups Group1, Group2, Group3`
Здесь User1 и Group1 - пользователь и группа к которым нужно разрешить доступ.

## ИСПОЛЬЗОВАНИЕ SSH
### ПОДКЛЮЧЕНИЕ К СЕРВЕРУ

Чтобы просто подключиться к серверу по SSH используйте такую команду:
 `ssh user@host`
 
Мы привыкли подключаться к удаленному серверу, а уже потом выполнять нужные команды, но на самом деле утилита ssh позволяет сразу выполнить нужную команду без открытия терминала удаленной машины. Например:
 `ssh user@host ls`
Выполнит команду ls на удаленном сервере и вернет ее вывод в текущий терминал.

### АУТЕНТИФИКАЦИЯ БЕЗ ПАРОЛЯ
Использование ssh пароля для входа на сервер не только неудобно но и небезопасно. 
 Самый надежный и часто используемый способ аутентификации - с помощью пары ключей RSA. Секретный ключ хранится на компьютере, а публичный используется на сервере для удостоверения пользователя.

Настроить такое поведение очень легко. Сначала создайте ключ командой:

 `ssh-keygen -t rsa`

Во время создания ключа нужно будет ответить на несколько вопросов, расположение оставляйте по умолчанию, если хотите подключаться без пароля - поле Passphare тоже оставьте пустым.

Затем отправляем ключ на сервер:

 `ssh-copy-id -i ~/.ssh/id_rsa.pub user@host`

Вот и все. Теперь при попытке подключится к этому серверу пароль запрашиваться не будет, а стазу произойдет подключение. Смотрите подробнее [создание открытого ключа для ssh](http://feanor184.ru/linux/kak-sozdat-otkryityiy-zakryityiy-ssh-klyuch-v-linux.html).

### СМОТРИМ НЕУДАЧНЫЕ ПОПЫТКИ ВХОДА SSH

Хотите посмотреть были ли попытки неудачного доступа по ssh к вашему серверу и с каких IP адресов? Запросто, все запросы логируются в файл /var/log/secure, отфильтруем только нужные данные командой:
 `cat /var/log/secure | grep "Failed password for"`




___
##### Links
[[Протокол SSH]]


---
##### Источники
https://losst.ru/kak-polzovatsya-ssh