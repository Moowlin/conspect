202106291604
Tags:
___
# Описание
Утилита читает документ по одной строке за раз, выполняет указанные вами действия и выводит результат на стандартный вывод. 
Одна из самых частых задач, для которых используется awk - это выборка одной из колонок. 
Все параметры awk находятся в кавычках, а действие, которое надо выполнить - в фигурных скобках. Вот основной её синтаксис:
```shell
$ awk опции 'условие {действие}'
$ awk опции 'условие {действие} условие {действие}'
```

С помощью действия можно выполнять преобразования с обрабатываемой строкой. 

==**Опции** утилиты:==
-   **-F, --field-separator** - разделитель полей, используется для разбиения текста на колонки;
-   **-f, --file** - прочитать данные не из стандартного вывода, а из файла;
-   **-v, --assign** - присвоить значение переменной, например foo=bar;
-   **-b, --characters-as-bytes** - считать все символы однобайтовыми;
-   **-d, --dump-variables** - вывести значения всех переменных awk по умолчанию;
-   **-D, --debug** - режим отладки, позволяет вводить команды интерактивно с клавиатуры;
-   **-e, --source** - выполнить указанный код на языке awk;
-   **-o, --pretty-print** - вывести результат работы программы в файл;
-   **-V, --version** - вывести версию утилиты.

==**Функции-действия**:==
-   **print(строка)** - вывод чего либо в стандартный поток вывода;
-   **printf(строка)** - форматированный вывод в стандартный поток вывода;
-   **system(команда)** - выполняет команду в системе;
-   **length(строка)** - возвращает длину строки;
-   **substr(строка, старт, количество)** - обрезает строку и возвращает результат;
-   **tolower(строка)** - переводит строку в нижний регистр;
-   **toupper(строка)** - переводить строку в верхний регистр.

В функциях-действиях можно использовать различные ==переменные и операторы== (можно объявлять свои):
-   **FNR** - номер обрабатываемой строки в файле;
-   **FS** - разделитель полей;
-   **NF** - количество колонок в данной строке;
-   **NR** - общее количество строк в обрабатываемом тексте;
-   **RS** - разделитель строк, по умолчанию символ новой строки;
-   **$** - ссылка на колонку по номеру.

==**Условие**== позволяет обрабатывать только те строки, в которых содержатся нужные нам данные, его можно использовать в качестве фильтра, как grep. А ещё условие позволяет выполнять определенные блоки кода awk для начала и конца файла, для этого вместо регулярного выражения используйте директивы **BEGIN** (начало) и **END** (конец).

# Примеры использования
## Чтение awk-скриптов из командной строки
Скрипты awk, которые можно писать прямо в командной строке, оформляются в виде текстов команд, заключённых в фигурные скобки. Кроме того, так как awk предполагает, что скрипт представляет собой текстовую строку, его нужно заключить в одинарные кавычки:  
```shell
$ awk '{print "Welcome to awk command tutorial"}'
```
После запуска команды ничего не будет происходить, так как awk ожидает данных из STDINю Тыкаем интер - вуаял, на экране выводится надпись `"Welcome to awk command tutorial"` Для того, чтобы завершить работу awk, нужно передать ему символ конца файла (EOF, End-of-File). Сделать это можно, воспользовавшись сочетанием клавиш `CTRL + D`.

## Позиционные переменные, хранящие данные полей
По умолчанию awk назначает следующие переменные каждому полю данных, обнаруженному им в записи:  
-   `$0 —` представляет всю строку текста (запись).
-   `$1 —` первое поле.
-   `$2 —` второе поле.
-   `$n —` n-ное поле.
Поля выделяются из текста с использованием символа-разделителя. По умолчанию — это пробельные символы вроде пробела или символа табуляции.
```shell
$ echo 'one two thee four' | awk '{print $1}'               
one
```

Ключ awk `-F`, который позволяет задать необходимый для обработки конкретного файла разделитель:
```shell
$ echo 'one:two:thee:four' | awk -F: '{print $1}'  
one
```

## Использование нескольких команд
Для того, чтобы передать awk многострочную команду при вызове его из консоли, нужно разделить её части точкой с запятой:
```shell
$ echo "My name is Tom" | awk '{$4="Adam"; print $0}'       
My name is Adam
```

## Чтение скрипта awk из файла
`awk` позволяет хранить скрипты в файлах и ссылаться на них, используя ключ `-f`
Подготовим файл `testfile`, в который запишем следующее:  
```shell
{print $1 " has a  home directory at " $6}
```
Вызовем awk, указав этот файл в качестве источника команд:  
```shell
$ awk -F: -f testfile /etc/passwd
```
В файле скрипта может содержаться множество команд, при этом каждую из них достаточно записывать с новой строки, ставить после каждой точку с запятой не требуется.  
Вот как это может выглядеть:  
```shell
{
text = " has a  home directory at "
print $1 text $6
}
```



___
##### Links
[[Регулярные выражнеия linux]]

---
##### Источники
[manual](https://www.gnu.org/software/gawk/manual/html_node/)
https://www.opennet.ru/docs/RUS/bash_scripting_guide/x14802.html

<iframe height=500 width=700 src="https://habr.com/ru/company/ruvds/blog/327754/"></iframe>

<iframe height=500 width=700 src="https://losst.ru/ispolzovanie-awk-v-linux"></iframe>